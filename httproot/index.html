<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test</title>
    <script src="https://cdn.jsdelivr.net/npm/animejs/lib/anime.iife.min.js"></script>
    <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
    <div id="game">
        <div class="fullscreen center-children">
            <img id="plate" src="/img/Tree_Of_Life 2.png" alt="plate">
            <img id="spinner" src="/img/spinner.png" alt="spinner" onclick="spin(this)">
        </div>
        <div id="card-container" class="fullscreen horizontal-layout">
            <div id="card-1" class="card disabled"><img src="" alt=""></div>
            <div id="card-2" class="card disabled"><img src="" alt=""></div>
            <div id="card-3" class="card disabled"><img src="" alt=""></div>
            <div id="card-3" class="card disabled"><img src="" alt=""></div>
            <div id="card-3" class="card disabled"><img src="" alt=""></div>
        </div>
        <div class="fullscreen">
            <!-- <button onclick="restart()">Replay</button> -->
        </div>
    </div>

    <script>
        const { animate, utils } = anime;
        let rotation = 0;
        let hasSpun = false;
        // let spinAnimationDuration = 10 * 1000;
        let spinAnimationDuration = 1000;

        function spin(element) {
            if (!hasSpun) {
                hasSpun = true;

                const monthMoonIndex = Math.floor((Math.random() * 32));
                utils.$('.card').forEach((e, i) => {
                    const imageIndex = i * 32 + monthMoonIndex;
                    e.querySelector('img').src = `/img/card-0.5x-${String(imageIndex)}.jpg`;
                });

                const anglePerIndex = 360 / 32.0;
                const additionalRotations = Math.round(2 + Math.random() * 5) * 360;
                rotation = additionalRotations + monthMoonIndex * anglePerIndex;
                $spinner = utils.$('#spinner');
                animate($spinner, {
                    rotate: rotation,
                    ease: 'out(4)',
                    duration: spinAnimationDuration,
                }).then(() => {
                    utils.$('.card').forEach((e, i) => {
                        e.classList.remove('disabled');
                        setTimeout(() => {
                            e.classList.add('bob');
                        }, 1 * 1000)
                    });
                });
            }
        }

        function restart() {
            location.reload();
        }
    </script>
</body>
</html>